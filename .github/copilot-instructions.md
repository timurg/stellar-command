# Copilot Instructions for `stellar-command`
## Требования к архитектуре движения и паттернам проектирования
- Весь физический движок (ускорение, ограничение скорости, ротация) реализован в базовом классе `Entity` через методы `UpdateMovement` и `UpdateRotation`.
- Потомки `Entity` (например, `Ship`, `Enemy`, `Carrier`) не управляют Rigidbody напрямую, а только вычисляют и устанавливают свойство `Direction`.
- Алгоритм вычисления направления (`Direction`) реализуется в потомках: например, AI, патрулирование, следование за целью, ввод игрока.
- Базовый класс `Ship` содержит общие свойства и методы для всех кораблей (щиты, список оружия-контроллеров `WeaponGun`, состояния, стрельба), но не реализует конкретную логику движения или выбора цели.
- Алгоритм движения (патруль, атака, возврат и т.д.) и выбор цели реализуются в классах-наследниках через переопределение методов и установку `Direction`.
- Для выбора цели используется абстрактный метод `SelectTarget()` в `Ship`, который реализуется в потомках.

**Пример:**
- В `Enemy` в методе `Update()` вычисляется направление к цели или по орбите и присваивается `Direction`. Вся физика движения и ротация обрабатываются в `Entity`.

**Главная идея:** потомки отвечают только за "куда и зачем двигаться", а "как двигаться" реализовано единообразно в `Entity`; стрельба оркестрируется в `Ship` через `WeaponGun`, а сами снаряды управляются пулами.

## Архитектура и основные компоненты
- Проект — Unity-игра, основной код в папке `Assets/Scripts/`
- Главные сущности: `Entity` (база), `Ship` (база кораблей), `WeaponGun` (контроллер оружия на корабле), `ProjectileBase` (снаряд), менеджеры (`StarFieldManager`, `StarLayerController`)
- Корабли реализуют движение и выбор цели через наследование от `Ship`; стрельба — через список `WeaponGun` и вызов `ShootAtTarget()`
- Снаряды порождаются из `WeaponGun` через `ProjectilePoolManager` (Unity ObjectPool), оружия обычно не пуллируются
- Взаимодействие между объектами через компоненты Unity и ссылки на объекты (`Entity target`, трансформы)

## Важные паттерны и соглашения
- Все основные игровые объекты — MonoBehaviour, используют сериализацию Unity (`[SerializeField]`)
- Для движения и ротации кораблей используется физика Rigidbody2D, ротация реализована через Slerp к целевому углу
- Пулинг: `EnemyPoolManager` — для врагов, `InterceptorPoolManager` — для истребителей, `ProjectilePoolManager` — для снарядов (по префабу)
- Коллизии между кораблями игнорируются через метод `IgnoreShipCollisions` (см. `Ship.cs`)
- Состояния корабля (`ShipState`) управляются через методы `GetState`/`SetState`, с дополнительной логикой при смене состояния
- Оружие добавляется через инспектор или кодом, стрельба реализована циклом по списку оружия

## Сборка, тестирование, отладка
- Сборка и запуск — стандартные для Unity: используйте Unity Editor (`.sln`, `.csproj` для IDE)
- Логирование — через `Debug.Log`, ошибки и важные события выводятся в консоль Unity
- Для отладки поведения кораблей и коллизий используйте логи из методов типа `IgnoreShipCollisions`
- Тесты не обнаружены, используйте Play Mode для ручной проверки

## Внешние зависимости и интеграции
- Используется стандартный Unity API (Rigidbody2D, Collider2D, MonoBehaviour)
- В проекте нет специфических внешних библиотек, кроме стандартных Unity пакетов

## Примеры ключевых файлов
- `Assets/Scripts/Core/Ship.cs` — паттерны движения, ротации, стрельбы (через `WeaponGun`), состояния
- `Assets/Scripts/Core/WeaponGun.cs` — контроллер оружия: кулдаун, прицеливание, спавн снарядов из пула
- `Assets/Scripts/Core/ProjectileBase.cs` — базовый снаряд: полёт, урон, возврат в пул
- `Assets/Scripts/Core/ProjectilePoolManager.cs` — пулинг снарядов через ObjectPool (на каждый префаб)
- `Assets/Scripts/Core/Weapon.cs` — устаревающий класс; оставлен для совместимости, постепенно заменяется на `WeaponGun`/`ProjectileBase`
- `Assets/Scripts/Core/Entity.cs` — базовая логика для игровых объектов
- Менеджеры: `StarFieldManager.cs`, `StarLayerController.cs` — управление слоями и эффектами

## Рекомендации для AI-агентов
- Следуйте паттернам сериализации и компонентной архитектуры Unity
- Для новых сущностей наследуйте от `Entity` или `Ship`, реализуйте абстрактные методы
- Оружие добавляется как компоненты `WeaponGun` на точки крепления (muzzle/mount) корабля, данные оружия могут быть в ScriptableObject
- При добавлении оружия/снарядов подключайте их к `ProjectilePoolManager`; не используйте Destroy для снарядов — возвращайте в пул
- Для взаимодействия между объектами используйте ссылки на компоненты и трансформы
- Все изменения должны быть совместимы с Unity Editor и не нарушать сериализацию

---

_Обновите этот файл при изменении архитектуры или появлении новых паттернов. Для уточнения — обратитесь к владельцу проекта._
